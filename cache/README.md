# Cache
## Get Started
```
docker compose up -d
```

## 負荷テスト
1. セットアップ
事前に過去のデータを削除する

```bash
docker compose down && docker compose up -d
```
2. テストを実行
   
```bash
docker compose run k6 run /scripts/no-cache.js

docker compose run k6 run /scripts/cache-hit.js

docker compose run k6 run /scripts/mixed-operations.js
```

| ファイル名          | シナリオ                                   |
| ------------------- | ------------------------------------------ |
| no-cache.js         | キャッシュがない状態でのユーザー検索       |
| cache-hit.js        | 同じユーザーの連続検索（キャッシュヒット） |
| mixed-operations.js | 書き込みと読み取りの混合テスト             |
| no-cache-db.js      | キャッシュがない状態でのユーザー検索(w/o redis)  |
| cache-hit-db.js     | 同じユーザーの連続検索（w/o redis） |
| mixed-operations-db.js | 書き込みと読み取りの混合テスト（w/o redis） |

| 同じユーザーの連続検索（キャッシュヒット）| Redis | DB |
|------|--------|---------|
| 成功率 | 100% | 100% |
| レスポンスタイム（平均） | 3.46ms | 259.33ms |
| レスポンスタイム（最小） | 0.398ms | 36.68ms |
| レスポンスタイム（最大） | 87.21ms | 974.07ms |
| レスポンスタイム（90パーセンタイル） | 5.64ms | 442.62ms |
| スループット | 72.29回/秒 | 21.01回/秒 |
| データ転送量（受信） | 800 kB | 233 kB |
| データ転送量（送信） | 443 kB | 133 kB |
| エラー率 | 0% | 0% |
| 同時接続ユーザー数 | 1-10 | 1-10 |

| キャッシュがない状態でのユーザー検索 | Redis | DB |
|------|--------|---------|
| 成功率 | 100% | 100% |
| レスポンスタイム（平均） | 324.00ms | 314.54ms |
| レスポンスタイム（最小） | 45.24ms | 41.08ms |
| レスポンスタイム（最大） | 661.51ms | 734.62ms |
| レスポンスタイム（90パーセンタイル） | 412.88ms | 412.87ms |
| スループット | 23.15回/秒 | 23.85回/秒 |
| データ転送量（受信） | 231 kB | 238 kB |
| データ転送量（送信） | 192 kB | 202 kB |
| エラー率 | 0% | 0% |
| 同時接続ユーザー数 | 1-10 | 1-10 |

| 書き込みと読み取りの混合テスト | Redis | DB |
|------|--------|---------|
| 成功率 | 100% | 100% |
| レスポンスタイム（平均） | 65.68ms | 71.61ms |
| レスポンスタイム（最小） | 37.74ms | 37.70ms |
| レスポンスタイム（最大） | 526.16ms | 674.75ms |
| レスポンスタイム（90パーセンタイル） | 90.95ms | 87.70ms |
| スループット | 8.31回/秒 | 8.23回/秒 |
| データ転送量（受信） | 85 kB | 86 kB |
| データ転送量（送信） | 79 kB | 81 kB |
| エラー率 | 0% | 0% |
| 同時接続ユーザー数 | 1-10 | 1-10 |
| READ時の平均レスポンスタイム | 61.85ms | 70.30ms |
| WRITE時の平均レスポンスタイム | 67.29ms | 72.19ms |